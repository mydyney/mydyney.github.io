{{- $permalink := .Permalink | absURL -}}
{{- $title := .Title -}}
{{- $lang := .Language.Lang -}}

<div class="sns-share-box">
    <div class="sns-share-title">
        {{ if eq $lang "ja" }}記事をシェアする{{ else if eq $lang "zh-cn" }}分享文章{{ else }}Share this post{{ end }}
    </div>

    <!-- X (Twitter) -->
    <a href="https://twitter.com/intent/tweet?url={{ $permalink }}&text={{ $title }}" class="sns-button tw"
        target="_blank" rel="noopener noreferrer" title="Share on X">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path
                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
            </svg>
        </span>
    </a>

    <!-- Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ $permalink }}" class="sns-button fb" target="_blank"
        rel="noopener noreferrer" title="Share on Facebook">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path
                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
            </svg>
        </span>
    </a>

    <!-- Threads -->
    <a href="https://www.threads.net/intent/post?text={{ $title | urlquery }}%0A{{ $permalink | urlquery }}"
        class="sns-button th" target="_blank" rel="noopener noreferrer" title="Share on Threads">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path
                    d="M14.88 11.53c0-.81-.17-1.44-.51-1.88s-.82-.67-1.45-.67c-.47 0-.85.12-1.15.35s-.51.52-.62.87c.22-.4.59-.72 1.1-.96s1.11-.35 1.79-.35c1.06 0 1.9.34 2.51 1.02s.92 1.63.92 2.85c0 1.38-.36 2.5-.1.08s.1-.1.2-.1c.33 0 .59.1.78.31s.29.5.29.85c0 .07-.01.15-.03.24s-.05.17-.09.25s-.08.15-.14.22s-.13.13-.21.18c-.62.4-1.34.6-2.14.6c-1.16 0-2.1-.37-2.82-1.11s-1.08-1.74-1.08-3s.36-2.26 1.08-3s1.66-1.11 2.82-1.11c1.04 0 1.9.33 2.58.99s1.02 1.55 1.02 2.66c0 1.97-.44 3.51-1.32 4.62s-2.13 1.66-3.74 1.66c-1.55 0-2.79-.45-3.72-1.35s-1.39-2.15-1.39-3.75c0-1.67.48-3.01 1.45-4.01s2.23-1.5 3.79-1.5c.37 0 .73.03 1.08.08s.68.13.99.23s.59.23.83.39s.44.35.59.57l-.88.75c-.24-.31-.57-.55-.99-.71s-.88-.24-1.39-.24c-1.28 0-2.31.4-3.08 1.2s-1.16 1.92-1.16 3.35c0 1.28.32 2.3.96 3.06s1.55 1.14 2.72 1.14c1.23 0 2.21-.4 2.94-1.21s1.1-1.94 1.1-3.41c0-.85-.15-1.53-.46-2.04s-.75-.77-1.32-.77c-.45 0-.82.12-1.11.35s-.5.53-.63.9c.17-.46.49-.83.97-1.11s1.07-.42 1.77-.42c1.01 0 1.83.33 2.46.99s.94 1.57.94 2.73c0 1.29-.35 2.32-1.05 3.09s-1.66 1.16-2.88 1.16c-1.14 0-2.05-.36-2.73-1.08s-1.02-1.7-1.02-2.93s.36-2.26 1.08-3s1.67-1.11 2.83-1.11c1.06 0 1.93.33 2.61.99s1.02 1.54 1.02 2.65c0 1.18-.32 2.11-.96 2.79s-1.55 1.02-2.72 1.02c-1.23 0-2.21-.4-2.94-1.21s-1.1-1.94-1.1-3.41c0-.85.15-1.53.46-2.04s.74-.77 1.31-.77c.46 0 .83.12 1.11.35s.5.53.63.9l-.88.75c-.15-.22-.35-.41-.59-.57s-.52-.29-.83-.39s-.64-.18-.99-.23s-.71-.08-1.08-.08c-1.56 0-2.82.5-3.79 1.5s-1.45 2.34-1.45 4.01c0 1.6.46 2.85 1.39 3.75s2.17 1.35 3.72 1.35c1.61 0 2.86-.55 3.74-1.66s1.32-2.65 1.32-4.62c0-1.11-.34-2-1.02-2.66s-1.54-.99-2.58-.99z" />
            </svg>
        </span>
    </a>

    <!-- Line -->
    <a href="https://social-plugins.line.me/lineit/share?url={{ $permalink }}" class="sns-button li" target="_blank"
        rel="noopener noreferrer" title="Share on Line">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path
                    d="M24 10.304c0-5.369-5.383-9.738-12-9.738-6.616 0-12 4.369-12 9.738 0 4.814 4.269 8.846 10.036 9.608.391.084.922.258 1.057.59.121.303.079.778.039 1.083l-.171 1.027c-.052.303-.251 1.184 1.08 0 1.331-1.183 7.185-4.229 9.802-7.23 1.808-1.928 2.157-3.702 2.157-5.078zm-15.533 3.424h-1.64c-.321 0-.582-.261-.582-.582V8.528c0-.321.261-.582.582-.582h.582c.321 0 .582.261.582.582v2.622h1.058c.321 0 .582.261.582.582v.996c0 .321-.261.582-.582.582zm2.49 0h-.582c-.321 0-.582-.261-.582-.582V8.528c0-.321.261-.582.582-.582h.582c.321 0 .582.261.582.582v5.2c0 .321-.261.582-.582.582zm4.15 0h-.582c-.321 0-.582-.261-.582-.582V10.27l-2.071 3.238c-.061.096-.164.154-.275.154h-.232c-.111 0-.214-.058-.275-.154l-2.071-3.238v3.154c0 .321-.261.582-.582.582h-.582c-.321 0-.582-.261-.582-.582V8.528c0-.321.261-.582.582-.582h.232c.111 0 .214.058.275.154l2.203 3.442v-3.014c0-.321.261-.582.582-.582h.582c.321 0 .582.261.582.582v1.742l2.203-3.442c.061-.096.164-.154.275-.154h.232c.111 0 .214.058.275.154l2.071 3.238V8.528c0-.321.261-.582.582-.582h.582c.321 0 .582.261.582.582v5.2c0 .321-.261.582-.582.582zm4.15-1.162h-1.058V11.23h1.058c.321 0 .582-.261.582-.582v-.996c0-.321-.261-.582-.582-.582h-1.058V8.528c0-.321-.261-.582-.582-.582h-1.64c-.321 0-.582.261-.582.582v5.2c0 .321.261.582.582.582h2.222c.321 0 .582-.261.582-.582v-.996c0-.321-.261-.582-.582-.582z" />
            </svg>
        </span>
    </a>

    {{ if eq $lang "ja" }}
    <!-- Hatena -->
    <a href="https://b.hatena.ne.jp/entry/panel/?url={{ $permalink }}&title={{ $title }}" class="sns-button hb"
        target="_blank" rel="noopener noreferrer" title="Hatena Bookmark">
        <span class="sns-icon-wrapper" style="font-weight: 900; font-size: 1.1rem; color: #fff;">B!</span>
    </a>
    {{ end }}

    {{ if eq $lang "zh-cn" }}
    <!-- Weibo -->
    <a href="http://service.weibo.com/share/share.php?url={{ $permalink }}&title={{ $title }}" class="sns-button wb"
        target="_blank" rel="noopener noreferrer" title="Share on Weibo">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path
                    d="M10.978 18.156c-3.111.233-5.836-.931-6.1-2.593-.261-1.666 2.062-3.21 5.161-3.447 3.111-.233 5.833.931 6.102 2.597.264 1.663-2.052 3.206-5.163 3.443zm1.144-8.813c-.347-.11-.84.288-.84.288s-.24.316-.017.585c.225.268.805.158.805.158s.457-.04.48-.383c.023-.347-.428-.648-.428-.648zM9.488 20.25c-5.234.331-9.488-2.673-9.488-6.102 0-1.748 1.111-3.328 2.924-4.526 1.006-.666 2.451-.72 3.42-.457-.158-.236-.316-.487-.411-.75-.3-.822-.124-1.676.435-2.288 1.05-1.147 3.15-.99 4.685.347.161.14.316.29.45.45.54-.783 1.38-1.41 2.385-1.748.24-.078.487-.132.743-.161 1.05-.124 2.053.15 2.76.71.503.402.748.96.72 1.545-.045.937-.805 1.506-1.506 1.56a1.144 1.144 0 0 1-1.124-.84c-.457-.225-.922-.3-1.35-.187-.315.083-.564.277-.72.54-.3.48-.187 1.08.277 1.485.421.36.96.616 1.53.75 4.314.99 6.786 3.654 6.786 6.307 0 3.75-4.47 6.643-11.755 7.186zm2.34-11.85a9.04 9.04 0 0 0-2.34-1.922c-1.845-.968-3.09-1.395-4.425-.262-1.24 1.05-.225 3.322-.225 3.322.045-.225.412-1.312 1.38-1.545.96-.233 2.04.143 2.04.143s1.29.805 1.635 2.506c-.03-.045.503-2.01 1.935-2.242z" />
            </svg>
        </span>
    </a>
    {{ end }}

    <!-- Copy Link -->
    <a href="#" class="sns-button cp" id="copy-sns-url" title="Copy Link">
        <span class="sns-icon-wrapper">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
        </span>
    </a>
</div>

<script>
    (function () {
        function initSnsCopy() {
            const copyBtn = document.getElementById('copy-sns-url');
            if (!copyBtn) return;

            // Remove existing listener if any to avoid duplicates
            const newBtn = copyBtn.cloneNode(true);
            copyBtn.parentNode.replaceChild(newBtn, copyBtn);

            newBtn.addEventListener('click', function (e) {
                e.preventDefault();
                const url = window.location.href;

                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(url)
                        .then(() => showFeedback(newBtn))
                        .catch(err => fallbackCopy(url, newBtn));
                } else {
                    fallbackCopy(url, newBtn);
                }
            });
        }

        function fallbackCopy(text, btn) {
            try {
                const tmp = document.createElement('textarea');
                tmp.value = text;
                tmp.style.position = 'fixed';
                tmp.style.left = '-9999px';
                tmp.style.top = '0';
                document.body.appendChild(tmp);
                tmp.focus();
                tmp.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(tmp);
                if (successful) showFeedback(btn);
            } catch (err) {
                console.error('Copy failed', err);
            }
        }

        function showFeedback(btn) {
            btn.classList.add('copied');
            setTimeout(() => btn.classList.remove('copied'), 2000);
        }

        // Initialize on load and also on possible dynamic updates
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSnsCopy);
        } else {
            initSnsCopy();
        }
    })();
</script>